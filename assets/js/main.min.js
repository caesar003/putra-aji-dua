$(document).ready(function(){"use strict";class e{constructor(){this.relations=["Ayah/Ibu","Suami/Istri","Anak","Saudara"],this.inversed=["Anak","Suami/Istri","Ayah/Ibu","Saudara"]}addRelations(e,t){const n=this.getInversed(t),i=[];for(let t=0;t<n.length;t++)$.ajax({url:`${U}/home/updateRelation`,type:"post",dataType:"json",async:!1,data:{nik:n[t].person.nik,family:`${n[t].person.family}${e}${n[t].rel}`},success:function(e){i.push(e)}});if(!i.find(e=>!e))return!0}updateRelation(e,t){let n=!1;return $.ajax({url:`${U}/home/updateRelation`,type:"post",dataType:"json",async:!1,data:{nik:t,family:e},success:function(e){n=e}}),n}getRelationInversed(e){return this.inversed[this.relations.findIndex(t=>t===e)]}getRelation(e){}getRelationId(e){return this.relations.findIndex(t=>t===e)+1}getRelationIdInversed(e){return this.inversed.indexOf(e)+1}groupMembers(e,t){const n=[],i=[],a=[];for(let i=0;i<e.length;i++){const{nik:a}=e[i].person;void 0===t.find(e=>e.person.nik===a)&&n.push(e[i])}for(let n=0;n<t.length;n++){const{nik:a}=t[n].person;void 0===e.find(e=>e.person.nik===a)&&i.push(t[n])}for(let n=0;n<t.length;n++){const{person:i,rel:l}=t[n];e.find(e=>e.person.nik===i.nik&&e.rel!==l)&&a.push(t[n])}return{toRemove:n,toAdd:i,toUpdate:a}}getChief(e){let t="";const n=State.data.find(t=>Number(t.nikk)===e&&Number(t.iskk));return(n||void 0!==n)&&(t=n.name),t}getObj(e){const t=[];for(let n=0;n<e.length;n+=16){const i=Number(e.slice(n,n+15)),a=Number(e.slice(n+15,n+16)),l=State.data.find(e=>Number(e.nik)===i),s=this.relations[a-1];t.push({person:l,rel:s})}return t}getAge(e,t){const n=new Date(e),i=void 0!==t?new Date(t):new Date,a=n.getFullYear(),l=n.getMonth(),s=n.getDate(),r=i.getFullYear(),o=i.getMonth(),d=i.getDate();let h=r-a;return(l>o||l===o&&s>d)&&h--,h}getString(e){let t="";for(let n=0;n<e.length;n++)t+=`${e[n].person.nik}${this.relations.findIndex(t=>t===e[n].rel)}`;return t}getDetailedInfo(e){return`<li><strong>NIK</strong>: ${e.nik}</li>\n      <li><strong>No KK</strong>: ${e.nikk}</li>\n      <li><strong>Nama</strong>: ${e.name}</li>\n      <li><strong>Lahir</strong>: ${$.format.date(e.dob,"dd/MM/yyyy")} (${this.getAge(e.dob)} tahun)</li>\n      <li><strong>Jenis Kelamin</strong>: ${"m"===e.gender?"P":"L"}</li>\n      <li><strong>Status tinggal</strong>: ${Number(e.status)?"Menetap":"Merantau"}</li>`}getFamilyList(e){let t="";const n=this.getObj(e.family),i=n.find(e=>"Suami/Istri"===e.rel),a=n.filter(e=>"Anak"===e.rel),l=n.filter(e=>"Ayah/Ibu"===e.rel),s=n.filter(e=>"Saudara"===e.rel),r={father:"<li><strong>Ayah</strong>: ",mother:"<li><strong>Ibu</strong>: ",spouse:`<li><strong>${"m"===e.gender?"Istri":"Suami"}</strong>: `,kids:"<li><strong>Anak</strong>: ",siblings:"<li><strong>Saudara</strong>: "};if(l.length){const e=l.find(e=>"m"===e.person.gender),t=l.find(e=>"f"===e.person.gender);r.father+=`${e.person.name}`,r.mother+=`${t.person.name}`}else r.mother+=" - ",r.father+=" - ";if(r.spouse+=i?`${i.person.name}`:" - ",a.length)for(let e=0;e<a.length;e++)r.kids+=`${a[e].person.name}${e!==a.length-1?", ":""}`;else r.kids+=" - ";if(s.length)for(let e=0;e<s.length;e++)r.siblings+=`${s[e].person.name}${e!==s.length-1?", ":""}`;else r.siblings+=" - ";r.father+="</li>",r.mother+="</li>",r.spouse+="</li>",r.kids+="</li>",r.siblings+="</li>";for(let e in r)t+=r[e];return t}getInversed(e){const t=[];for(let n=0;n<e.length;n+=16){const i=Number(e.slice(n,n+15)),a=Number(e.slice(n+15,n+16)),l=State.data.find(e=>Number(e.nik)===i);let s=null;switch(a){case 1:s=3;break;case 2:s=2;break;case 3:s=1;break;default:s=4}t.push({person:l,rel:s})}return t}parseForm(e,t){let n="";if(e.length&&e[0].value&&t[0].value)for(let i=0;i<e.length;i++)n+=`${e[i].value}${t[i].value}`;return n}parseNames(e){let t="";if(e||""!==e||void 0!==e){const n=this.getObj(e);for(let e=0;e<n.length;e++){let i="";t+=`<span class="" title="${i="Suami/Istri"===n[e].rel?"m"===n[e].person.gender?"Suami":"Istri":"Ayah/Ibu"===n[e].rel?"m"===n[e].person.gender?"Ayah":"Ibu":n[e].rel}">${n[e].person.name}</span>${e!==n.length-1?", ":""}`}}return t}generateSelections(e,t,n){let i='<option value="">Pilih</option>',a='<option value="">Pilih</option>';for(let e=0;e<this.relations.length;e++)i+=`<option value="${e+1}" ${this.relations[e]===t?"selected":""}>${this.relations[e]}</option>`;for(let t=0;t<n.length;t++)a+=`<option value="${n[t].nik}" ${Number(e)===Number(n[t].nik)?"selected":""}>${n[t].name}</option>`;return{relations:i,members:a}}generateFamilySelect(e,t){let n="";const i=this.getObj(e),a=State.data.filter(e=>Number(e.nik)!==Number(t));for(let e=0;e<i.length;e++){const{relations:t,members:l}=this.generateSelections(i[e].person.nik,i[e].rel,a);n+=`<div class="row my-1">\n          ${0===e?'<label class="col-3">Keluarga</label>':""}\n          <div class="col-4${0!==e?" offset-3":""}">\n            <select class="family-memberE form-select form-select-sm">\n            ${l}\n            </select>\n          </div>\n          <div class="col-${0===e?"5":"4"}">\n            <select class="family-relationE form-select form-select-sm">\n              ${t}\n            </select>\n          </div>\n          ${0!==e?'<div class="col-1 p-1">\n        <a class="remove-family-memberE" title="Hapus" href="#"><i class="fas fa-times fa-fw"></i></a>\n      </div>':""}\n        </div>`}return n}getPersonHtmlEl(e){return`<div data-nik="${e.nik}" class="person-icon ${e.gender} ${String(e.h)===String(e.nik)?"highlighted":""}" style="--x:${e.x}%;--y:${e.y}%;">\n          <i class="fas fa-user-alt"></i> <br>\n          ${e.name}\n        </div>`}getMaritalLine(e){return`<div class="marital-line" style="--x:${e.x}%; --y:${e.y}%;"></div>`}getKidsVLine(e){return`<div class="kids-v-line" style="--x:${e.x}%;--y:${e.y}%;"></div>`}getKidsHLine(e){return`<div class="kids-h-line" style="--x: ${e.x}%;--y: ${e.y}%;--w:${e.w}%;"></div>`}getHeadLine(e){return`<div class="head-line" style="--x: ${e.x}%;--y:${e.y}%;"></div>`}generateFamilyTreeHtml(e){let t="";const{leftMostPerson:n,topLevelPerson:i,xInterval:a,yIntervalLevel:l,mLineXDiff:s,mLineYDiff:r,vLineXDiff:o,vLineYDiff:d,headLineXDiff:h,headLineYDiff:g}={leftMostPerson:2,topLevelPerson:5,xInterval:12,yIntervalLevel:15,mLineXDiff:9,mLineYDiff:2,vLineXDiff:10.2,vLineYDiff:2,hLineYDiff:15,headLineXDiff:4,headLineYDiff:-3};"man"===e.gender?(t+=this.getPersonHtmlEl({h:e.highlighted,name:e.name,nik:e.nik,gender:e.gender,x:n,y:i}),t+=this.getPersonHtmlEl({h:e.highlighted,name:e.spouse.name,nik:e.spouse.nik,gender:e.spouse.gender,x:n+a,y:i})):(t+=this.getPersonHtmlEl({h:e.highlighted,name:e.spouse.name,nik:e.spouse.nik,gender:e.spouse.gender,x:n,y:i}),t+=this.getPersonHtmlEl({h:e.highlighted,name:e.name,nik:e.nik,gender:e.gender,x:n+a,y:i})),t+=this.getMaritalLine({x:n+s,y:i+r}),e.children&&e.children.length&&(t+=this.getKidsVLine({x:n+o,y:i+d}));const m=n+o;let c=0,f=0,u=0,k=0;if(e.children&&e.children.length){for(let m=0;m<e.children.length;m++)if(void 0!==e.children[m].spouse){if("man"===e.children[m].gender?(t+=this.getPersonHtmlEl({h:e.highlighted,name:e.children[m].name,gender:e.children[m].gender,nik:e.children[m].nik,x:n+c*a,y:i+l}),t+=this.getHeadLine({x:n+c*a+h,y:i+l+g}),t+=this.getPersonHtmlEl({h:e.highlighted,name:e.children[m].spouse.name,gender:e.children[m].spouse.gender,nik:e.children[m].spouse.nik,x:n+(c+1)*a,y:i+l}),0===m&&(u=n+c*a+h),m===e.children.length-1&&(k=n+c*a+h)):(t+=this.getPersonHtmlEl({h:e.highlighted,name:e.children[m].spouse.name,gender:e.children[m].spouse.gender,nik:e.children[m].spouse.nik,x:n+c*a,y:i+l}),t+=this.getPersonHtmlEl({h:e.highlighted,name:e.children[m].name,gender:e.children[m].gender,nik:e.children[m].nik,x:n+(c+1)*a,y:i+l}),t+=this.getHeadLine({x:n+(c+1)*a+h,y:i+l+g}),0===m&&(u=n+(c+1)*a+h),m===e.children.length-1&&(k=n+(c+1)*a+h)),e.children[m].children&&e.children[m].children.length){let s=0,r=0;for(let o=0;o<e.children[m].children.length;o++)t+=this.getPersonHtmlEl({h:e.highlighted,name:e.children[m].children[o].name,gender:e.children[m].children[o].gender,nik:e.children[m].children[o].nik,x:n+f*a,y:i+2*l}),t+=this.getHeadLine({x:n+f*a+h,y:i+2*l+g}),0===o&&(s=n+f*a+h),o===e.children[m].children.length-1&&(r=n+f*a+h),f++;t+=this.getKidsVLine({x:n+a*c+o,y:l+i+d});const u=n+a*c+o,k=s<u?s:u,p=r>u?r:u;t+=this.getKidsHLine({x:k,y:31,w:p-k+.9})}t+=this.getMaritalLine({x:n+a*c+s,y:l+i+r}),c+=2}else t+=this.getPersonHtmlEl({h:e.highlighted,name:e.children[m].name,gender:e.children[m].gender,nik:e.children[m].nik,x:n+c*a,y:i+l}),t+=this.getHeadLine({x:n+c*a+h,y:i+l+g}),0===m&&(u=n+c*a+h),m===e.children.length-1&&(k=n+c*a+h),c++;const p=u<m?u:m,$=k>m?k:m;t+=this.getKidsHLine({x:p,y:16,w:$-p+.9})}return t}constructChildrenObj(e){return{name:e.person.name,nik:e.person.nik,gender:"m"===e.person.gender?"man":"woman"}}constructFamilyTree(e){const t=State.data.find(t=>String(t.nik)===String(e)),n=this.getDetailedInfo(t),i=this.getFamilyList(t),a={highlighted:e,name:null,nik:null,gender:"man",spouse:{name:null,gender:"woman",nik:null},children:[]},l=this.getObj(t.family),s=l.filter(e=>"Ayah/Ibu"===e.rel),r=l.find(e=>"Suami/Istri"===e.rel),o=l.filter(e=>"Anak"===e.rel),d=l.filter(e=>"Saudara"===e.rel).sort((e,t)=>new Date(e.person.dob).getTime()-new Date(t.person.dob).getTime()),h=d.filter(e=>new Date(e.person.dob).getTime()<new Date(t.dob).getTime()),g=d.filter(e=>new Date(e.person.dob).getTime()>new Date(t.dob).getTime()),m={name:t.name,nik:t.nik,gender:"m"===t.gender?"man":"woman"};if((r||void 0!==r)&&(m.spouse=this.constructChildrenObj(r)),o.length){m.children=[];for(let e=0;e<o.length;e++)m.children.push(this.constructChildrenObj(o[e]))}if(s.length){const e=s.find(e=>"m"===e.person.gender),t=s.find(e=>"f"===e.person.gender);if(a.name=e.person.name,a.nik=e.person.nik,a.gender="man",a.spouse=this.constructChildrenObj(t),a.children=[],h.length)for(let e=0;e<h.length;e++){const t=this.getObj(h[e].person.family),n=t.find(e=>"Suami/Istri"===e.rel),i=t.filter(e=>"Anak"===e.rel),l=this.constructChildrenObj(h[e]);if((n||void 0!==n)&&(l.spouse=this.constructChildrenObj(n)),i.length){l.children=[];for(let e=0;e<i.length;e++)l.children.push(this.constructChildrenObj(i[e]))}a.children.push(l)}if(a.children.push(m),g.length)for(let e=0;e<g.length;e++){const t=this.getObj(g[e].person.family),n=t.find(e=>"Suami/Istri"===e.rel),i=t.filter(e=>"Anak"===e.rel),l=this.constructChildrenObj(g[e]);if((n||void 0!==n)&&(l.spouse=this.constructChildrenObj(n)),i.length){l.children=[];for(let e=0;e<i.length;e++)l.children.push(this.constructChildrenObj(i[e]))}a.children.push(l)}}else!s.length&&o.length?(a.name=m.name,a.nik=m.nik,a.gender=m.gender,a.spouse=m.spouse,a.children=m.children):s.length||o.length||(a.name=m.name,a.nik=m.nik,a.gender=m.gender,a.spouse=m.spouse);const c=this.generateFamilyTreeHtml(a);console.log(a),$("#personInfo").removeClass("isHidden"),$("#stats").addClass("isHidden"),$("#familyTree").html(c),$("#personalInfo").html(n),$("#familyList").html(i)}formatDate(e){const t=e.slice(0,2),n=e.slice(3,5),i=e.slice(6,11);return`${t}-${["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][n-1]}-${i}`}groupKK(){const{data:e}=State,t=[];for(let n=0;n<State.data.length;n++)t.push(e[n].nikk);const n=[...new Set(t)];for(let e=0;e<n.length;e++)console.log()}}const t=new e;class n{get(){$.ajax({url:`${U}/home/get`,dataType:"json",success:function(e){console.log(e)}})}add(){const e={vals:{nik:$("#nik").val(),nikk:$("#nikk").val(),name:$("#name").val(),rw:$("#rw").val(),rt:$("#rt").val(),dob:$("#dob").val(),status:$('select[name="status"] option:selected').val(),gender:$('select[name="gender"] option:selected').val(),iskk:$("#iskk").is(":checked")?1:0,familyMembers:t.parseForm($(".family-member"),$(".family-relation"))},fields:{nik:$("#nik"),nikk:$("#nikk"),name:$("#name"),rw:$("#rw"),rt:$("#rt"),dob:$("#dob"),status:$("#status"),gender:$("#gender"),iskk:$("iskk")},fEl:$("#newCitizenFeedback")},{vals:n,fields:i,fEl:a}=e,{nik:l,nikk:s,name:r,rw:o,rt:d,dob:h,status:g,gender:m,iskk:c,familyMembers:f}=n,{nik:u,nikk:k,name:p,rw:b,rt:v,dob:y,status:E,gender:w}=i;this.validate({vals:[l,s,r,o,d,h,g,m],fields:[u,k,p,b,v,y,E,w],fEl:a})?t.addRelations(l,f)&&$.ajax({type:"post",url:`${U}/home/add`,dataType:"json",data:{nik:l,nikk:s,name:r,rw:o,rt:d,dob:h,status:g,gender:m,iskk:c,family:f},success:function(e){$(".remove-family-member").parent().parent().remove(),$("#nik, #nikk, #name, #rw, #rt, #dob, #status, #gender, .family-member, .family-relation").val(""),$("#iskk").prop("checked",!1),$("#citizenList").DataTable().ajax.reload(),getData(),$("#newCitizenModal").modal("hide")}}):console.log("an error occured")}appendMember(e){let t=`<div class="row my-1">\n\n        <div class="col-4 offset-3">\n          <select class="family-member form-select form-select-sm">\n            ${State.familySelectList}\n          </select>\n        </div>\n        <div class="col-4">\n          <select class="family-relation form-select form-select-sm">\n            <option value="">Pilih</option>\n            <option value="1">Ayah/Ibu</option>\n            <option value="2">Suami/Istri</option>\n            <option value="3">Anak</option>\n            <option value="4">Saudara</option>\n          </select>\n        </div>\n        <div class="col-1 p-1">\n          <a class="remove-family-member" title="Hapus" href="#"><i class="fas fa-times fa-fw"></i></a>\n        </div>\n      </div>`;e.append(t)}appendMemberE(e){let t=`<div class="row my-1">\n        <div class="col-4 offset-3">\n          <select class="family-memberE form-select form-select-sm">\n            ${State.familySelectList}\n          </select>\n        </div>\n        <div class="col-4">\n          <select class="family-relationE form-select form-select-sm">\n          <option value="">Pilih</option>\n          <option value="1">Ayah/Ibu</option>\n          <option value="2">Suami/Istri</option>\n          <option value="3">Anak</option>\n          <option value="4">Saudara</option>\n          </select>\n        </div>\n        <div class="col-1 p-1">\n          <a class="remove-family-memberE" title="Hapus" href="#"><i class="fas fa-times fa-fw"></i></a>\n        </div>\n      </div>`;e.append(t)}validate({vals:e,fields:t,fEl:n}){let i=!1;const a=[];for(let t=0;t<e.length;t++)e[t]&&void 0!==e[t]||a.push(t);if(a.length){for(let e=0;e<a.length;e++)highlightField(t[a[e]]);showError(n,"Data tidak lengkap!")}else{const a=String(e[0]);15!==a.length?(showError(n,"NIK harus berjumlah 15 angka!"),highlightField(t[0])):this.isNikAvailable(a)?i=!0:(showError(n,"NIK sudah digunakan!"),highlightField(t[0]))}return i}validateUpdate({id:e,vals:t,fields:n,fEl:i}){let a=!1;const l=[];for(let e=0;e<t.length;e++)t[e]&&void 0!==t[e]||l.push(e);if(l.length){for(let e=0;e<l.length;e++)highlightField.fields[l[e]];showError(i,"Data tidak lengkap!")}else{const l=String(t[0]);15!==l.length?(showError(i,"NIK harus berjumlah 15 angka!"),highlightField(n[0])):this.nikOnAnotherUser(e,l)?showError(i,"Nik telah digunakan!"):a=!0}return a}isNikAvailable(e){let t=!1;return $.ajax({url:`${U}/home/isNikAvailable`,dataType:"json",async:!1,data:{nik:e},success:function(e){t=e}}),t}nikOnAnotherUser(e,t){let n=!1;return $.ajax({url:`${U}/home/nikOnAnotherUser`,async:!1,dataType:"json",data:{nik:t,id:e},success:function(e){e&&e.length&&(n=!0)}}),n}updateInit(e){const n=e.target.parentNode.dataset.id||e.target.dataset.id;State.toEdit.id=n;const i=State.data.find(e=>Number(e.id)===Number(n)),{dob:a,family:l,gender:s,iskk:r,name:o,nik:d,nikk:h,rt:g,rw:m,status:c}=i,f=t.generateFamilySelect(l,d);$("#nikE").val(d),$("#nikkE").val(h),$("#nameE").val(o),$("#rwE").val(m),$("#rtE").val(g),$("#dobE").val($.format.date(a,"yyyy-MM-dd")),$("#statusE").val(c),$("#genderE").val(s),$("#iskkE").prop("checked",Number(r)||!1),$("#editCitizenModal").modal("show"),$("#familyMembersE").html(f)}update(){const{id:e}=State.toEdit,n={vals:{nik:$("#nikE").val(),nikk:$("#nikkE").val(),name:$("#nameE").val(),rw:$("#rwE").val(),rt:$("#rtE").val(),dob:$("#dobE").val(),status:$('select[name="statusE"] option:selected').val(),gender:$('select[name="genderE"] option:selected').val(),iskk:$("#iskkE").is(":checked")?1:0,familyMembers:t.parseForm($(".family-memberE"),$(".family-relationE"))},fields:{nik:$("#nikE"),nikk:$("#nikkE"),name:$("#nameE"),rw:$("#rwE"),rt:$("#rtE"),dob:$("#dobE"),status:$("#statusE"),gender:$("#genderE"),iskk:$("iskkE")},fEl:$("#editCitizenFeedback")},{vals:i,fields:a,fEl:l}=n,{nik:s,nikk:r,name:o,rw:d,rt:h,dob:g,status:m,gender:c,iskk:f,familyMembers:u}=i,{nik:k,nikk:p,name:b,rw:v,rt:y,dob:E,status:w,gender:I}=a;if(this.validateUpdate({id:e,vals:[s,r,o,d,h,g,m,c],fields:[k,p,b,v,y,E,w,I],fEl:l})){const n=State.data.find(t=>t.id===e);if(n.family!==u){const e=n.family,i=u;if(e&&!i){const i=t.getObj(e);for(let e=0;e<i.length;e++){let a="";const l=t.getObj(i[e].person.family).filter(e=>Number(e.person.nik)!==Number(n.nik));for(let e=0;e<l.length;e++)a+=`${l[e].person.nik}${t.getRelationId(l[e].rel)}`;t.updateRelation(a,i[e].person.nik)}}else if(!e&&i){const e=t.getInversed(i);for(let i=0;i<e.length;i++)t.updateRelation(`${e[i].person.family}${n.nik}${e[i].rel}`,e[i].person.nik)}else if(e&&i){const a=t.getObj(i),l=t.getObj(e),{toRemove:s,toAdd:r,toUpdate:o}=t.groupMembers(l,a);if(s.length)for(let e=0;e<s.length;e++){let i="";const a=t.getObj(s[e].person.family).filter(e=>e.person.nik!==n.nik);for(let e=0;e<a.length;e++)i+=`${a[e].person.nik}${t.getRelationId(a[e].rel)}`;t.updateRelation(i,s[e].person.nik)}if(o.length)for(let e=0;e<o.length;e++){let i="";const a=t.getObj(o[e].person.family);a[a.findIndex(e=>e.person.nik===n.nik)].rel=t.getRelationInversed(o[e].rel);for(let e=0;e<a.length;e++)i+=`${a[e].person.nik}${t.getRelationId(a[e].rel)}`;t.updateRelation(i,o[e].person.nik)}if(r.length)for(let e=0;e<r.length;e++){t.updateRelation(`${r[e].person.family}${n.nik}${t.getRelationIdInversed(r[e].rel)}`,r[e].person.nik)}}}$.ajax({type:"post",url:`${U}/home/update`,dataType:"json",data:{id:e,nik:s,nikk:r,name:o,rw:d,rt:h,dob:g,status:m,gender:c,iskk:f,family:u},success:function(e){$("#citizenList").DataTable().ajax.reload(),getData(),$("#editCitizenModal").modal("hide")}})}else console.log(!1)}deleteInit(e){const t=e.target.dataset.id||e.target.parentNode.dataset.id;State.toDelete.id=t,$("#deleteCitizenModal").modal("show")}delete(){const e=State.toDelete.id,n=State.data.find(t=>Number(t.id)===Number(e)),i=t.getObj(n.family);if(i.length)for(let e=0;e<i.length;e++){let a="";const l=t.getObj(i[e].person.family).filter(e=>e.person.nik!==n.nik);if(l.length)for(let e=0;e<l.length;e++)a+=`${l[e].person.nik}${t.getRelationId(l[e].rel)}`;t.updateRelation(a,i[e].person.nik)}$.ajax({url:`${U}/home/delete`,type:"post",dataType:"json",async:!1,data:{id:e},success:function(e){$("#citizenList").DataTable().ajax.reload(),getData(),$("#deleteCitizenModal").modal("hide")}})}makeGenderChart(){const e=State.data,t=e.length,n=e.filter(e=>"m"===e.gender).length,i=e.filter(e=>"f"===e.gender).length,a={man:`${n} (${(n/t*100).toFixed(2)}%)`,mDeg:`${n/t*360}`,woman:`${i} (${(i/t*100).toFixed(2)}%)`,wDeg:`${i/t*360}`},l=`<li><i style="color:pink;" class="fas fa-user-alt"></i> <strong>P</strong>: ${a.woman} </li>\n      <li><i style="color:navy;" class="fas fa-user-alt"></i> <strong>L</strong>: ${a.man}</li>`,s=`<div class="pie-chart" style="--g:navy ${a.mDeg}deg, pink 0;"></div>`;$("#genderList").html(l),$("#genderChart").html(s)}makeAgeGroupChart(){const e=State.data,n=e.length,i=e.filter(e=>t.getAge(e.dob)<=20).length,a=i/n*360,l=e.filter(e=>t.getAge(e.dob)>20&&t.getAge(e.dob)<50).length,s=l/n*360,r=e.filter(e=>t.getAge(e.dob)>50).length;let o=`<li><i style="color:#dd4b39;" class="fas fa-user-alt"></i> <strong>&lt;20 tahun</strong>: ${i} (${(i/n*100).toFixed(2)}%)</li>\n      <li><i style="color:#9cb443;" class="fas fa-user-alt"></i> <strong>21-50 tahun</strong>: ${l} (${(l/n*100).toFixed(2)}%)</li>\n      <li><i style="color:#007bb6;" class="fas fa-user-alt"></i> <strong>&gt;50 tahun</strong>: ${r} (${(r/n*100).toFixed(2)}%)</li>`,d=`<div class="pie-chart" style="--g:#dd4b39 ${a}deg, #9cb443 0 ${s+a}deg, #007bb6 0;"></div>`;$("#ageGroup").html(o),$("#ageChart").html(d)}}const i=new n;$("#citizenList").DataTable({ajax:{url:`${U}/home/get`,dataSrc:""},columns:[{data:"nik"},{data:{nik:"nik",nikk:"nikk"},render:(e,t,n)=>`<a href="javascript:void(0);" class="person-item" data-nik="${e.nik}">${e.nikk}</a>`},{data:"name"},{data:"nikk",render:(e,n,i)=>`${t.getChief(Number(e))}`},{data:"rw"},{data:"rt"},{data:"dob",render:(e,n,i)=>t.formatDate($.format.date(e,"dd-MM-yyyy"))},{data:"dob",render:(e,n,i)=>t.getAge(e)},{data:"gender",render:(e,t,n)=>"m"===e?"L":"P"},{data:"status",render:(e,t,n)=>1===Number(e)?"Menetap":"Merantau"},{data:"family",render:(e,n,i)=>`${t.parseNames(e)}`},{data:"id",render:(e,t,n)=>`<a href="javascript:void(0);" class="edit-citizen" data-id="${e}"><i class="fas fa-pencil-alt"></i></a> <a href="javascript:void(0);" class="delete-citizen" data-id="${e}"><i class="fas fa-trash"></i></a>`}]}),t.groupKK(),$("#newCitizenForm").on("submit",function(e){e.preventDefault(),i.add()}),$(".add-family-member").on("click",function(){const e=$("#familyMembers");i.appendMember(e)}),$("#familyMembers").on("click",".remove-family-member",function(){$(this).parent().parent().remove()}),$(".add-family-memberE").on("click",function(){const e=$("#familyMembersE");i.appendMemberE(e)}),$("#familyMembersE").on("click",".remove-family-memberE",function(){$(this).parent().parent().remove()}),$("#citizenList").on("click",".edit-citizen",i.updateInit),$("#editCitizenForm").on("submit",function(e){e.preventDefault(),i.update()}),$("#citizenList").on("click",".delete-citizen",i.deleteInit),$("#deleteCitizenForm").on("submit",function(e){e.preventDefault(),i.delete()}),$("#citizenList").on("click",".person-item",function(e){const n=$(this).data("nik");t.constructFamilyTree(n)}),$("#personInfo").on("click",".btn-close",function(){$("#personInfo").addClass("isHidden"),$("#stats").removeClass("isHidden")}),$("#familyTree").on("click",".person-icon",function(){const e=$(this).data("nik");t.constructFamilyTree(e)}),i.makeGenderChart(),i.makeAgeGroupChart()});